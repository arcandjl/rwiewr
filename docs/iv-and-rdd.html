<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 4 IV and RDD | Real World Impact Evaluation with R</title>
  <meta name="description" content="Real world impact evaluation with R.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 4 IV and RDD | Real World Impact Evaluation with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Real world impact evaluation with R." />
  <meta name="github-repo" content="arcandjl/rwIEwr" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 IV and RDD | Real World Impact Evaluation with R" />
  
  <meta name="twitter:description" content="Real world impact evaluation with R." />
  

<meta name="author" content="Department of International Economics">
<meta name="author" content="The Graduate Institute | Geneva">
<meta name="author" content="jean-louis.arcand@graduateinstitute.ch">


<meta name="date" content="2019-01-24">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="setting-up-an-evaluation.html">
<link rel="next" href="panel-data-structures.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Real world impact evaluation with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome to Real World Impact Evaluation with R</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#author"><i class="fa fa-check"></i>Author</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="why-go-to-all-the-trouble-potential-outcomes.html"><a href="why-go-to-all-the-trouble-potential-outcomes.html"><i class="fa fa-check"></i><b>1</b> Why go to all the trouble? Potential outcomes</a><ul>
<li class="chapter" data-level="1.1" data-path="why-go-to-all-the-trouble-potential-outcomes.html"><a href="why-go-to-all-the-trouble-potential-outcomes.html#why-evaluate"><i class="fa fa-check"></i><b>1.1</b> Why evaluate</a></li>
<li class="chapter" data-level="1.2" data-path="why-go-to-all-the-trouble-potential-outcomes.html"><a href="why-go-to-all-the-trouble-potential-outcomes.html#the-roy-model"><i class="fa fa-check"></i><b>1.2</b> The Roy model</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="randomization.html"><a href="randomization.html"><i class="fa fa-check"></i><b>2</b> Randomization</a><ul>
<li class="chapter" data-level="2.1" data-path="randomization.html"><a href="randomization.html#understanding-the-basics"><i class="fa fa-check"></i><b>2.1</b> Understanding the basics</a></li>
<li class="chapter" data-level="2.2" data-path="randomization.html"><a href="randomization.html#the-randomista-debate"><i class="fa fa-check"></i><b>2.2</b> The randomista debate</a></li>
<li class="chapter" data-level="2.3" data-path="randomization.html"><a href="randomization.html#randomization-inference"><i class="fa fa-check"></i><b>2.3</b> Randomization inference</a></li>
<li class="chapter" data-level="2.4" data-path="randomization.html"><a href="randomization.html#attempting-to-replicate-a-famous-paper"><i class="fa fa-check"></i><b>2.4</b> Attempting to replicate a famous paper</a></li>
<li class="chapter" data-level="2.5" data-path="randomization.html"><a href="randomization.html#ri-does-not-always-increase-standard-errors"><i class="fa fa-check"></i><b>2.5</b> RI does not always increase standard errors</a><ul>
<li class="chapter" data-level="2.5.1" data-path="randomization.html"><a href="randomization.html#baselines-and-endlines"><i class="fa fa-check"></i><b>2.5.1</b> Baselines and endlines</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="randomization.html"><a href="randomization.html#placebo-effects-and-surprise-homo-oeconomicus-is-alive-and-kicking"><i class="fa fa-check"></i><b>2.6</b> Placebo effects and (surprise) homo oeconomicus is alive and kicking</a></li>
<li class="chapter" data-level="2.7" data-path="randomization.html"><a href="randomization.html#re-introducing-choice-into-randomizations"><i class="fa fa-check"></i><b>2.7</b> Re-introducing choice into randomizations</a><ul>
<li class="chapter" data-level="2.7.1" data-path="randomization.html"><a href="randomization.html#wing-et-al-approach"><i class="fa fa-check"></i><b>2.7.1</b> Wing et al approach</a></li>
<li class="chapter" data-level="2.7.2" data-path="randomization.html"><a href="randomization.html#rcts-as-a-principal-agent-problem"><i class="fa fa-check"></i><b>2.7.2</b> RCTs as a principal-agent problem</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="setting-up-an-evaluation.html"><a href="setting-up-an-evaluation.html"><i class="fa fa-check"></i><b>3</b> Setting up an evaluation</a><ul>
<li class="chapter" data-level="3.1" data-path="setting-up-an-evaluation.html"><a href="setting-up-an-evaluation.html#statistical-power-survey-data-and-just-doing-it"><i class="fa fa-check"></i><b>3.1</b> Statistical power, survey data and just doing it…</a><ul>
<li class="chapter" data-level="3.1.1" data-path="setting-up-an-evaluation.html"><a href="setting-up-an-evaluation.html#blocking"><i class="fa fa-check"></i><b>3.1.1</b> Blocking</a></li>
<li class="chapter" data-level="3.1.2" data-path="setting-up-an-evaluation.html"><a href="setting-up-an-evaluation.html#repeated-observations"><i class="fa fa-check"></i><b>3.1.2</b> Repeated observations</a></li>
<li class="chapter" data-level="3.1.3" data-path="setting-up-an-evaluation.html"><a href="setting-up-an-evaluation.html#glossary-and-intuition"><i class="fa fa-check"></i><b>3.1.3</b> Glossary and intuition</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="setting-up-an-evaluation.html"><a href="setting-up-an-evaluation.html#stuff-to-keep-in-mind-survey-bias-and-hawthorne-effects"><i class="fa fa-check"></i><b>3.2</b> Stuff to keep in mind: Survey bias and Hawthorne effects</a></li>
<li class="chapter" data-level="3.3" data-path="setting-up-an-evaluation.html"><a href="setting-up-an-evaluation.html#illustration-was-my-research-design-underpowered"><i class="fa fa-check"></i><b>3.3</b> Illustration: Was my research design underpowered?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="iv-and-rdd.html"><a href="iv-and-rdd.html"><i class="fa fa-check"></i><b>4</b> IV and RDD</a><ul>
<li class="chapter" data-level="4.1" data-path="iv-and-rdd.html"><a href="iv-and-rdd.html#the-basics-of-iv"><i class="fa fa-check"></i><b>4.1</b> The basics of IV</a><ul>
<li class="chapter" data-level="4.1.1" data-path="iv-and-rdd.html"><a href="iv-and-rdd.html#the-forbidden-regression"><i class="fa fa-check"></i><b>4.1.1</b> The forbidden regression</a></li>
<li class="chapter" data-level="4.1.2" data-path="iv-and-rdd.html"><a href="iv-and-rdd.html#weak-instruments"><i class="fa fa-check"></i><b>4.1.2</b> Weak instruments</a></li>
<li class="chapter" data-level="4.1.3" data-path="iv-and-rdd.html"><a href="iv-and-rdd.html#finite-sample-bias"><i class="fa fa-check"></i><b>4.1.3</b> Finite sample bias</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="iv-and-rdd.html"><a href="iv-and-rdd.html#bootstrap-inference"><i class="fa fa-check"></i><b>4.2</b> Bootstrap inference</a></li>
<li class="chapter" data-level="4.3" data-path="iv-and-rdd.html"><a href="iv-and-rdd.html#failure-of-the-exclusion-restriction"><i class="fa fa-check"></i><b>4.3</b> Failure of the exclusion restriction</a></li>
<li class="chapter" data-level="4.4" data-path="iv-and-rdd.html"><a href="iv-and-rdd.html#the-gmm-black-box"><i class="fa fa-check"></i><b>4.4</b> The GMM black box</a></li>
<li class="chapter" data-level="4.5" data-path="iv-and-rdd.html"><a href="iv-and-rdd.html#regression-discontinuity-design"><i class="fa fa-check"></i><b>4.5</b> Regression discontinuity design</a><ul>
<li class="chapter" data-level="4.5.1" data-path="iv-and-rdd.html"><a href="iv-and-rdd.html#application-to-a-development-program"><i class="fa fa-check"></i><b>4.5.1</b> Application to a development program</a></li>
<li class="chapter" data-level="4.5.2" data-path="iv-and-rdd.html"><a href="iv-and-rdd.html#pushing-the-outcome-variable"><i class="fa fa-check"></i><b>4.5.2</b> Pushing the outcome variable</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="panel-data-structures.html"><a href="panel-data-structures.html"><i class="fa fa-check"></i><b>5</b> Panel data structures</a><ul>
<li class="chapter" data-level="5.1" data-path="panel-data-structures.html"><a href="panel-data-structures.html#reviewing-the-basics"><i class="fa fa-check"></i><b>5.1</b> Reviewing the basics</a><ul>
<li class="chapter" data-level="5.1.1" data-path="panel-data-structures.html"><a href="panel-data-structures.html#within-between-and-variance-components"><i class="fa fa-check"></i><b>5.1.1</b> Within, between and variance components</a></li>
<li class="chapter" data-level="5.1.2" data-path="panel-data-structures.html"><a href="panel-data-structures.html#multidimensional-panels"><i class="fa fa-check"></i><b>5.1.2</b> Multidimensional panels</a></li>
<li class="chapter" data-level="5.1.3" data-path="panel-data-structures.html"><a href="panel-data-structures.html#mundlak"><i class="fa fa-check"></i><b>5.1.3</b> Mundlak</a></li>
<li class="chapter" data-level="5.1.4" data-path="panel-data-structures.html"><a href="panel-data-structures.html#the-incidental-parameters-problem"><i class="fa fa-check"></i><b>5.1.4</b> The incidental parameters problem</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="panel-data-structures.html"><a href="panel-data-structures.html#common-situations"><i class="fa fa-check"></i><b>5.2</b> Common situations</a><ul>
<li class="chapter" data-level="5.2.1" data-path="panel-data-structures.html"><a href="panel-data-structures.html#panel-data-in-an-rct"><i class="fa fa-check"></i><b>5.2.1</b> Panel data in an RCT</a></li>
<li class="chapter" data-level="5.2.2" data-path="panel-data-structures.html"><a href="panel-data-structures.html#instrumental-variables"><i class="fa fa-check"></i><b>5.2.2</b> Instrumental variables</a></li>
<li class="chapter" data-level="5.2.3" data-path="panel-data-structures.html"><a href="panel-data-structures.html#selection-and-endogeneity"><i class="fa fa-check"></i><b>5.2.3</b> Selection and endogeneity</a></li>
<li class="chapter" data-level="5.2.4" data-path="panel-data-structures.html"><a href="panel-data-structures.html#inference-and-clustering"><i class="fa fa-check"></i><b>5.2.4</b> Inference and clustering</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="panel-data-structures.html"><a href="panel-data-structures.html#time-invariant-covariates"><i class="fa fa-check"></i><b>5.3</b> Time-invariant covariates</a></li>
<li class="chapter" data-level="5.4" data-path="panel-data-structures.html"><a href="panel-data-structures.html#measurement-error"><i class="fa fa-check"></i><b>5.4</b> Measurement error</a><ul>
<li class="chapter" data-level="5.4.1" data-path="panel-data-structures.html"><a href="panel-data-structures.html#attenuation-bias"><i class="fa fa-check"></i><b>5.4.1</b> Attenuation bias?</a></li>
<li class="chapter" data-level="5.4.2" data-path="panel-data-structures.html"><a href="panel-data-structures.html#to-wrongs-can-make-a-right"><i class="fa fa-check"></i><b>5.4.2</b> To wrongs can make a right</a></li>
<li class="chapter" data-level="5.4.3" data-path="panel-data-structures.html"><a href="panel-data-structures.html#heteroskedasticity-can-be-your-friend"><i class="fa fa-check"></i><b>5.4.3</b> Heteroskedasticity can be your friend</a></li>
<li class="chapter" data-level="5.4.4" data-path="panel-data-structures.html"><a href="panel-data-structures.html#higher-moments"><i class="fa fa-check"></i><b>5.4.4</b> Higher moments</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="panel-data-structures.html"><a href="panel-data-structures.html#pseudo-panel-data"><i class="fa fa-check"></i><b>5.5</b> Pseudo-panel data</a></li>
<li class="chapter" data-level="5.6" data-path="panel-data-structures.html"><a href="panel-data-structures.html#synthetic-control"><i class="fa fa-check"></i><b>5.6</b> Synthetic control</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="external-validity-replicability-and-lack-of-statistical-significance.html"><a href="external-validity-replicability-and-lack-of-statistical-significance.html"><i class="fa fa-check"></i><b>6</b> External validity, replicability and lack of statistical significance</a><ul>
<li class="chapter" data-level="6.1" data-path="external-validity-replicability-and-lack-of-statistical-significance.html"><a href="external-validity-replicability-and-lack-of-statistical-significance.html#external-validity"><i class="fa fa-check"></i><b>6.1</b> External validity</a></li>
<li class="chapter" data-level="6.2" data-path="external-validity-replicability-and-lack-of-statistical-significance.html"><a href="external-validity-replicability-and-lack-of-statistical-significance.html#replicability-and-scientific-progress"><i class="fa fa-check"></i><b>6.2</b> Replicability and scientific progress</a></li>
<li class="chapter" data-level="6.3" data-path="external-validity-replicability-and-lack-of-statistical-significance.html"><a href="external-validity-replicability-and-lack-of-statistical-significance.html#saying-something-intelligent-when-things-arent-statistically-significant"><i class="fa fa-check"></i><b>6.3</b> Saying something intelligent when things aren’t statistically significant</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="heterogeneity-in-various-flavors.html"><a href="heterogeneity-in-various-flavors.html"><i class="fa fa-check"></i><b>7</b> Heterogeneity in various flavors</a><ul>
<li class="chapter" data-level="7.1" data-path="heterogeneity-in-various-flavors.html"><a href="heterogeneity-in-various-flavors.html#quantile-regressions-and-random-coefficient-models"><i class="fa fa-check"></i><b>7.1</b> Quantile regressions and random coefficient models</a></li>
<li class="chapter" data-level="7.2" data-path="heterogeneity-in-various-flavors.html"><a href="heterogeneity-in-various-flavors.html#essential-heterogeneity"><i class="fa fa-check"></i><b>7.2</b> Essential heterogeneity</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Real World Impact Evaluation with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="iv-and-rdd" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> IV and RDD</h1>
<div id="the-basics-of-iv" class="section level2">
<h2><span class="header-section-number">4.1</span> The basics of IV</h2>
<p><span class="citation">Hausman (<a href="#ref-Hausman83">1983</a>)</span></p>
<p>Lecture notes on IV bias</p>
<div id="the-forbidden-regression" class="section level3">
<h3><span class="header-section-number">4.1.1</span> The forbidden regression</h3>
<p>A common mistake in running IV regressions, especially when done in a two-step procedure, is what has memorably been termed by Jerry Hausman “the forbidden regression.”</p>
<p>Lecture notes on the forbidden regression</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mvtnorm)
<span class="kw">library</span>(AER)
MC.endogeneity &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">N=</span><span class="dv">1000</span>,<span class="dt">covuud=</span><span class="fl">0.5</span>,<span class="dt">covxz=</span><span class="fl">0.5</span>,<span class="dt">alfa=</span><span class="fl">1.0</span>,<span class="dt">pi=</span><span class="fl">1.0</span>, <span class="dt">gamma=</span><span class="fl">0.5</span>, <span class="dt">phi=</span><span class="fl">0.0</span>){
  ## Parameters
  beta &lt;-<span class="st"> </span><span class="fl">1.0</span>
  sigma &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(  <span class="dv">1</span>,covuud,    <span class="dv">0</span>,    <span class="dv">0</span>,
                 covuud,     <span class="dv">1</span>,    <span class="dv">0</span>,    <span class="dv">0</span>,
                      <span class="dv">0</span>,     <span class="dv">0</span>,    <span class="dv">1</span>,covxz,
                      <span class="dv">0</span>,     <span class="dv">0</span>,covxz,   <span class="dv">1</span>),<span class="dt">ncol=</span><span class="dv">4</span>)
  
  ## generate residuals/variables 
  m &lt;-<span class="st"> </span><span class="kw">rmvnorm</span>(N,<span class="dt">mean=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="dt">sigma=</span>sigma)
  Z &lt;-<span class="st"> </span><span class="kw">matrix</span>(m[,<span class="dv">3</span>],N,<span class="dv">1</span>)
  X &lt;-<span class="st"> </span><span class="kw">matrix</span>(m[,<span class="dv">4</span>],N,<span class="dv">1</span>)
  
  ## Generate DGP:
  D &lt;-<span class="st"> </span>gamma<span class="op">*</span>Z <span class="op">+</span><span class="st"> </span>pi<span class="op">*</span>X           <span class="op">+</span><span class="st"> </span>m[,<span class="dv">2</span>]
  Y &lt;-<span class="st"> </span>beta<span class="op">*</span>D  <span class="op">+</span><span class="st"> </span>alfa<span class="op">*</span>X <span class="op">+</span><span class="st"> </span>phi<span class="op">*</span>Z <span class="op">+</span><span class="st"> </span>m[,<span class="dv">1</span>]
  
  
  ## Compute both estimators
  ols &lt;-<span class="st"> </span><span class="kw">summary</span>(<span class="kw">lm</span>(Y <span class="op">~</span><span class="st"> </span><span class="op">-</span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>D <span class="op">+</span><span class="st"> </span>X))<span class="op">$</span>coefficients[<span class="dv">1</span>,<span class="dv">1</span>]
  tsls &lt;-<span class="st"> </span><span class="kw">summary</span>(<span class="kw">ivreg</span>(Y <span class="op">~</span><span class="st"> </span><span class="op">-</span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>D <span class="op">+</span><span class="st"> </span>X <span class="op">|</span><span class="st"> </span>X <span class="op">+</span><span class="st"> </span>Z))<span class="op">$</span>coefficients[<span class="dv">1</span>,<span class="dv">1</span>]
  R &lt;-<span class="st"> </span><span class="kw">summary</span>(<span class="kw">lm</span>(D <span class="op">~</span><span class="st"> </span><span class="op">-</span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Z))<span class="op">$</span>residual
  forbidden &lt;-<span class="st"> </span><span class="kw">summary</span>(<span class="kw">lm</span>(Y <span class="op">~</span><span class="st"> </span><span class="op">-</span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>D <span class="op">+</span><span class="st"> </span>X <span class="op">+</span><span class="st"> </span>R))<span class="op">$</span>coefficients[<span class="dv">1</span>,<span class="dv">1</span>]
  
  ## Collect and return results
  res &lt;-<span class="st"> </span><span class="kw">c</span>(ols, tsls, forbidden, N, covuud, gamma, phi)
  <span class="kw">names</span>(res) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;2SLS&quot;</span>, <span class="st">&quot;forbidden&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;covuud&quot;</span>, <span class="st">&quot;gamma&quot;</span>, <span class="st">&quot;phi&quot;</span>)
  <span class="kw">return</span>(res)
  
}

## Try function once
<span class="kw">MC.endogeneity</span>()</code></pre></div>
<pre><code>##          OLS         2SLS    forbidden            N       covuud 
##    1.4148898    0.9657436    1.2154456 1000.0000000    0.5000000 
##        gamma          phi 
##    0.5000000    0.0000000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Run the DGP/estim 1000 times, with fixed parameters:
<span class="kw">system.time</span>(MC1 &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">500</span>, <span class="kw">MC.endogeneity</span>(<span class="dt">N=</span><span class="dv">1000</span>,<span class="dt">covuud=</span><span class="fl">0.5</span>,
                                                 <span class="dt">covxz=</span><span class="op">-</span><span class="fl">0.9</span>,<span class="dt">alfa=</span><span class="fl">1.0</span>,<span class="dt">pi=</span><span class="fl">1.0</span>, 
                                                 <span class="dt">gamma=</span><span class="fl">0.5</span>, <span class="dt">phi=</span><span class="fl">0.00</span>)))</code></pre></div>
<pre><code>##    user  system elapsed 
##    6.29    0.08    6.78</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Reshape data to have convenient form for graphs/tables:
<span class="kw">library</span>(reshape2)
MC1_long &lt;-<span class="st"> </span><span class="kw">melt</span>(<span class="kw">as.data.frame</span>(<span class="kw">t</span>(MC1)), <span class="dt">measure.vars=</span><span class="kw">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;2SLS&quot;</span>, <span class="st">&quot;forbidden&quot;</span>), 
                 <span class="dt">variable.name=</span><span class="st">&quot;Estimator&quot;</span>)

## Visualise the data
<span class="kw">library</span>(ggplot2)
<span class="co"># Plot with fixed parameters</span>
<span class="kw">qplot</span>(<span class="dt">x=</span>value<span class="op">-</span><span class="dv">1</span>, <span class="dt">data=</span>MC1_long, <span class="dt">geom=</span><span class="st">&quot;density&quot;</span>,<span class="dt">fill=</span>Estimator)<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>( <span class="dt">alpha=</span><span class="fl">0.5</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="op">-</span><span class="fl">1.0</span>,<span class="fl">1.0</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept=</span><span class="dv">0</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Montecarlo simulation results&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Centered Values&quot;</span>)</code></pre></div>
<p><img src="04-IV_RDD_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(plyr)

MC_tab &lt;-<span class="st"> </span><span class="kw">ddply</span>(MC1_long, .(Estimator, N, covuud, gamma, phi), summarise, 
                <span class="dt">means=</span><span class="kw">mean</span>(value, <span class="dt">na.rm=</span><span class="ot">TRUE</span>), 
                <span class="dt">bias=</span>means <span class="op">-</span><span class="dv">1</span>, 
                <span class="dt">var=</span><span class="kw">var</span>(value, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),
                <span class="dt">mse=</span>var<span class="op">+</span>bias<span class="op">^</span><span class="dv">2</span>
)
MC_tab</code></pre></div>
<pre><code>##   Estimator    N covuud gamma phi     means         bias         var
## 1       OLS 1000    0.5   0.5   0 1.4753419  0.475341914 0.000811993
## 2      2SLS 1000    0.5   0.5   0 0.9920654 -0.007934576 0.023083793
## 3 forbidden 1000    0.5   0.5   0 2.1353757  1.135375708 0.031921811
##          mse
## 1 0.22676193
## 2 0.02314675
## 3 1.32099981</code></pre>
</div>
<div id="weak-instruments" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Weak instruments</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mvtnorm)
MC.endogeneity &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">N=</span><span class="dv">100</span>,<span class="dt">cov=</span><span class="fl">0.5</span>, <span class="dt">gamma=</span><span class="fl">0.5</span>, <span class="dt">phi=</span><span class="fl">0.0</span>){
  ## Parameters
  beta &lt;-<span class="st"> </span><span class="fl">1.0</span>
  sigma &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,cov,<span class="dv">0</span>,
                    cov,<span class="dv">1</span>,<span class="dv">0</span>,
                    <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">ncol=</span><span class="dv">3</span>)
  
  ## generate residuals/variables 
  m &lt;-<span class="st"> </span><span class="kw">rmvnorm</span>(N,<span class="dt">mean=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="dt">sigma=</span>sigma)
  Z &lt;-<span class="st"> </span><span class="kw">matrix</span>(m[,<span class="dv">3</span>],N,<span class="dv">1</span>)
  
  ## Generate DGP:
  D &lt;-<span class="st"> </span>gamma<span class="op">*</span>Z <span class="op">+</span><span class="st"> </span>m[,<span class="dv">2</span>]
  Y &lt;-<span class="st"> </span>beta<span class="op">*</span>D <span class="op">+</span><span class="st"> </span>phi<span class="op">*</span>Z <span class="op">+</span><span class="st"> </span>m[,<span class="dv">1</span>]
  
  ## Compute both estimators
  ols &lt;-<span class="st"> </span><span class="kw">solve</span>(<span class="kw">crossprod</span>(D))<span class="op">%*%</span><span class="kw">crossprod</span>(D,Y)
  tsls &lt;-<span class="st"> </span><span class="kw">solve</span>(<span class="kw">crossprod</span>(D,Z)<span class="op">%*%</span><span class="kw">solve</span>(<span class="kw">crossprod</span>(Z))<span class="op">%*%</span><span class="kw">crossprod</span>(Z,D))<span class="op">%*%</span>
<span class="st">    </span><span class="kw">crossprod</span>(D,Z)<span class="op">%*%</span><span class="kw">solve</span>(<span class="kw">crossprod</span>(Z))<span class="op">%*%</span><span class="kw">crossprod</span>(Z,Y)
  
  ## Collect and return results
  res &lt;-<span class="st"> </span><span class="kw">c</span>(ols, tsls, N, cov, gamma, phi)
  <span class="kw">names</span>(res) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;2SLS&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;cov&quot;</span>, <span class="st">&quot;gamma&quot;</span>, <span class="st">&quot;phi&quot;</span>)
  <span class="kw">return</span>(res)
  
}

## Try function once
<span class="kw">MC.endogeneity</span>()</code></pre></div>
<pre><code>##        OLS       2SLS          N        cov      gamma        phi 
##   1.385696   1.008019 100.000000   0.500000   0.500000   0.000000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Run the DGP/estim 1000 times, with fixed parameters:
<span class="kw">system.time</span>(MC1 &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">MC.endogeneity</span>(<span class="dt">N=</span><span class="dv">1000</span>, <span class="dt">cov=</span><span class="fl">0.5</span>, <span class="dt">gamma=</span><span class="fl">0.8</span>, <span class="dt">phi=</span><span class="fl">0.0</span>)))</code></pre></div>
<pre><code>##    user  system elapsed 
##    0.76    0.04    0.86</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Reshape data to have convenient form for graphs/tables:
<span class="kw">library</span>(reshape2)
MC1_long &lt;-<span class="st"> </span><span class="kw">melt</span>(<span class="kw">as.data.frame</span>(<span class="kw">t</span>(MC1)), <span class="dt">measure.vars=</span><span class="kw">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;2SLS&quot;</span>), 
                 <span class="dt">variable.name=</span><span class="st">&quot;Estimator&quot;</span>)
## Visualise the data
<span class="kw">library</span>(ggplot2)
<span class="co"># Plot with fixed parameters</span>
<span class="kw">qplot</span>(<span class="dt">x=</span>value<span class="op">-</span><span class="dv">1</span>, <span class="dt">data=</span>MC1_long, <span class="dt">geom=</span><span class="st">&quot;density&quot;</span>,<span class="dt">fill=</span>Estimator)<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>( <span class="dt">alpha=</span><span class="fl">0.5</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="op">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept=</span><span class="dv">0</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Montecarlo simulation results&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Centered Values&quot;</span>)</code></pre></div>
<p><img src="04-IV_RDD_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">##############################
<span class="co"># Examples of &quot;faceted&quot; graphs</span>
##############################
<span class="kw">library</span>(plyr)
<span class="co"># Vary degree of endogeneity</span>
MC_tab &lt;-<span class="st"> </span><span class="kw">ddply</span>(MC1_long, .(Estimator, N, cov, gamma, phi), summarise, 
                <span class="dt">means=</span><span class="kw">mean</span>(value, <span class="dt">na.rm=</span><span class="ot">TRUE</span>), 
                <span class="dt">bias=</span>means <span class="op">-</span><span class="dv">1</span>, 
                <span class="dt">var=</span><span class="kw">var</span>(value, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),
                <span class="dt">mse=</span>var<span class="op">+</span>bias<span class="op">^</span><span class="dv">2</span>
)
MC_tab</code></pre></div>
<pre><code>##   Estimator    N cov gamma phi     means         bias         var
## 1       OLS 1000 0.5   0.8   0 1.3058918  0.305891842 0.000497911
## 2      2SLS 1000 0.5   0.8   0 0.9982554 -0.001744613 0.001597672
##           mse
## 1 0.094067730
## 2 0.001600716</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Run the DGP/estim 500 times, varying some parameters:
valgrid &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">cov=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>), <span class="dt">N=</span><span class="kw">c</span>(<span class="dv">200</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">5000</span>))
<span class="co">#valgrid &lt;- expand.grid(gamma=c(0.01, 0.1, 0.2, 0.5), N=c(200, 500, 1000, 5000))</span>

<span class="kw">system.time</span>(MCMC_mult_temp &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">500</span>, <span class="kw">mapply</span>(MC.endogeneity, <span class="dt">N=</span>valgrid<span class="op">$</span>N, <span class="dt">cov=</span>valgrid<span class="op">$</span>cov)))</code></pre></div>
<pre><code>##    user  system elapsed 
##    9.64    0.08   10.83</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#system.time(MCMC_mult_temp &lt;- replicate(500, mapply(MC.endogeneity, N=valgrid$N, gamma=valgrid$gamma)))</span>

<span class="co"># slower but more compact: system.time(MCMC_mult_temp &lt;- replicate(500, t(mdply(valgrid, MC.endogeneity))))</span>

MC_mult &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(MCMC_mult_temp)
MC_mult_long &lt;-<span class="st"> </span><span class="kw">melt</span>(<span class="kw">as.data.frame</span>(<span class="kw">t</span>(MC_mult)), <span class="dt">measure.vars=</span><span class="kw">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;2SLS&quot;</span>), 
                     <span class="dt">variable.name=</span><span class="st">&quot;Estimator&quot;</span>)



<span class="co"># Plot with 1 parameter varying, this new dimension is shown with the &quot;faceting&quot; system</span>
<span class="co"># as we represent according to one variable only, fix the N value:</span>
MC_mult_long_N1000 &lt;-<span class="st"> </span><span class="kw">subset</span>(MC_mult_long,N<span class="op">==</span><span class="dv">1000</span>)

<span class="kw">qplot</span>(<span class="dt">x=</span>value<span class="op">-</span><span class="dv">1</span>, <span class="dt">data=</span>MC_mult_long_N1000, <span class="dt">geom=</span><span class="st">&quot;density&quot;</span>,<span class="dt">fill=</span>Estimator)<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>( <span class="dt">alpha=</span><span class="fl">0.5</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="op">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept=</span><span class="dv">0</span>)<span class="op">+</span><span class="kw">ggtitle</span>(<span class="st">&quot;Montecarlo simulation results&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Centered Values&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(cov<span class="op">~</span>., <span class="dt">scales=</span><span class="st">&quot;free&quot;</span>)</code></pre></div>
<p><img src="04-IV_RDD_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#facet_grid(gamma~., scales=&quot;free&quot;)</span>

<span class="co"># Vary weakness of instruments</span>

MC_tab &lt;-<span class="st"> </span><span class="kw">ddply</span>(MC1_long, .(Estimator, N, cov, gamma, phi), summarise, 
                <span class="dt">means=</span><span class="kw">mean</span>(value, <span class="dt">na.rm=</span><span class="ot">TRUE</span>), 
                <span class="dt">bias=</span>means <span class="op">-</span><span class="dv">1</span>, 
                <span class="dt">var=</span><span class="kw">var</span>(value, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),
                <span class="dt">mse=</span>var<span class="op">+</span>bias<span class="op">^</span><span class="dv">2</span>
)
MC_tab</code></pre></div>
<pre><code>##   Estimator    N cov gamma phi     means         bias         var
## 1       OLS 1000 0.5   0.8   0 1.3058918  0.305891842 0.000497911
## 2      2SLS 1000 0.5   0.8   0 0.9982554 -0.001744613 0.001597672
##           mse
## 1 0.094067730
## 2 0.001600716</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Run the DGP/estim 500 times, varying some parameters:
<span class="co">#valgrid &lt;- expand.grid(cov=c(0, 0.2, 0.5, 0.7), N=c(200, 500, 1000, 5000))</span>
valgrid &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">gamma=</span><span class="kw">c</span>(<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>), <span class="dt">N=</span><span class="kw">c</span>(<span class="dv">200</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">5000</span>))

<span class="co">#system.time(MCMC_mult_temp &lt;- replicate(500, mapply(MC.endogeneity, N=valgrid$N, cov=valgrid$cov)))</span>
<span class="kw">system.time</span>(MCMC_mult_temp &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">500</span>, <span class="kw">mapply</span>(MC.endogeneity, <span class="dt">N=</span>valgrid<span class="op">$</span>N, <span class="dt">gamma=</span>valgrid<span class="op">$</span>gamma)))</code></pre></div>
<pre><code>##    user  system elapsed 
##    9.47    0.04   10.03</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># slower but more compact: system.time(MCMC_mult_temp &lt;- replicate(500, t(mdply(valgrid, MC.endogeneity))))</span>

MC_mult &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(MCMC_mult_temp)
MC_mult_long &lt;-<span class="st"> </span><span class="kw">melt</span>(<span class="kw">as.data.frame</span>(<span class="kw">t</span>(MC_mult)), <span class="dt">measure.vars=</span><span class="kw">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;2SLS&quot;</span>), 
                     <span class="dt">variable.name=</span><span class="st">&quot;Estimator&quot;</span>)



<span class="co"># Plot with 1 parameter varying, this new dimension is shown with the &quot;faceting&quot; system</span>
<span class="co"># as we represent according to one variable only, fix the N value:</span>
MC_mult_long_N1000 &lt;-<span class="st"> </span><span class="kw">subset</span>(MC_mult_long,N<span class="op">==</span><span class="dv">1000</span>)

<span class="kw">qplot</span>(<span class="dt">x=</span>value<span class="op">-</span><span class="dv">1</span>, <span class="dt">data=</span>MC_mult_long_N1000, <span class="dt">geom=</span><span class="st">&quot;density&quot;</span>,<span class="dt">fill=</span>Estimator)<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>( <span class="dt">alpha=</span><span class="fl">0.5</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="op">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept=</span><span class="dv">0</span>)<span class="op">+</span><span class="kw">ggtitle</span>(<span class="st">&quot;Montecarlo simulation results&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Centered Values&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(gamma<span class="op">~</span>., <span class="dt">scales=</span><span class="st">&quot;free&quot;</span>)</code></pre></div>
<p><img src="04-IV_RDD_files/figure-html/unnamed-chunk-3-3.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># facet_grid(cov~., scales=&quot;free&quot;)</span>


<span class="kw">library</span>(plyr)

MC_mult_tab &lt;-<span class="st"> </span><span class="kw">ddply</span>(MC_mult_long, .(N, cov, gamma, phi, Estimator), summarise, 
                <span class="dt">means=</span><span class="kw">mean</span>(value, <span class="dt">na.rm=</span><span class="ot">TRUE</span>), 
                <span class="dt">bias=</span>means <span class="op">-</span><span class="dv">1</span>, 
                <span class="dt">var=</span><span class="kw">var</span>(value, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),
                <span class="dt">mse=</span>var<span class="op">+</span>bias<span class="op">^</span><span class="dv">2</span>
)
MC_mult_tab</code></pre></div>
<pre><code>##       N cov gamma phi Estimator     means          bias          var
## 1   200 0.5  0.01   0       OLS 1.4957723  0.4957722761 3.526654e-03
## 2   200 0.5  0.01   0      2SLS 1.6485265  0.6485264581 2.003434e+02
## 3   200 0.5  0.10   0       OLS 1.4952861  0.4952860791 3.709683e-03
## 4   200 0.5  0.10   0      2SLS 1.0002797  0.0002796957 3.986906e+01
## 5   200 0.5  0.20   0       OLS 1.4809824  0.4809824329 3.797010e-03
## 6   200 0.5  0.20   0      2SLS 0.9428499 -0.0571500867 1.469914e+00
## 7   200 0.5  0.50   0       OLS 1.4061751  0.4061750550 3.311237e-03
## 8   200 0.5  0.50   0      2SLS 0.9966004 -0.0033996444 2.394334e-02
## 9   500 0.5  0.01   0       OLS 1.5004664  0.5004664402 1.481923e-03
## 10  500 0.5  0.01   0      2SLS 1.8742899  0.8742898895 3.499166e+02
## 11  500 0.5  0.10   0       OLS 1.4926854  0.4926853823 1.320294e-03
## 12  500 0.5  0.10   0      2SLS 1.3634650  0.3634649971 2.134895e+01
## 13  500 0.5  0.20   0       OLS 1.4801824  0.4801824004 1.420831e-03
## 14  500 0.5  0.20   0      2SLS 0.9804290 -0.0195709571 6.280146e-02
## 15  500 0.5  0.50   0       OLS 1.3996831  0.3996831374 1.238690e-03
## 16  500 0.5  0.50   0      2SLS 1.0101343  0.0101342584 7.825322e-03
## 17 1000 0.5  0.01   0       OLS 1.5006327  0.5006326801 6.960687e-04
## 18 1000 0.5  0.01   0      2SLS 1.5103645  0.5103645222 4.159108e+02
## 19 1000 0.5  0.10   0       OLS 1.4958432  0.4958432462 7.626958e-04
## 20 1000 0.5  0.10   0      2SLS 0.8538595 -0.1461405271 9.892227e-01
## 21 1000 0.5  0.20   0       OLS 1.4786717  0.4786716759 7.534934e-04
## 22 1000 0.5  0.20   0      2SLS 0.9930382 -0.0069618324 2.950913e-02
## 23 1000 0.5  0.50   0       OLS 1.3997947  0.3997947353 5.971488e-04
## 24 1000 0.5  0.50   0      2SLS 1.0017854  0.0017854258 3.862945e-03
## 25 5000 0.5  0.01   0       OLS 1.5002199  0.5002199168 1.520216e-04
## 26 5000 0.5  0.01   0      2SLS 0.0425699 -0.9574301048 7.480157e+02
## 27 5000 0.5  0.10   0       OLS 1.4954926  0.4954926134 1.731362e-04
## 28 5000 0.5  0.10   0      2SLS 0.9919130 -0.0080870318 2.398901e-02
## 29 5000 0.5  0.20   0       OLS 1.4806174  0.4806174437 1.384188e-04
## 30 5000 0.5  0.20   0      2SLS 1.0031504  0.0031503810 5.223867e-03
## 31 5000 0.5  0.50   0       OLS 1.4005615  0.4005614699 1.432612e-04
## 32 5000 0.5  0.50   0      2SLS 0.9968883 -0.0031117024 7.450825e-04
##             mse
## 1  2.493168e-01
## 2  2.007639e+02
## 3  2.490180e-01
## 4  3.986906e+01
## 5  2.351411e-01
## 6  1.473181e+00
## 7  1.682894e-01
## 8  2.395490e-02
## 9  2.519486e-01
## 10 3.506810e+02
## 11 2.440592e-01
## 12 2.148106e+01
## 13 2.319960e-01
## 14 6.318448e-02
## 15 1.609853e-01
## 16 7.928026e-03
## 17 2.513291e-01
## 18 4.161713e+02
## 19 2.466232e-01
## 20 1.010580e+00
## 21 2.298801e-01
## 22 2.955760e-02
## 23 1.604330e-01
## 24 3.866133e-03
## 25 2.503720e-01
## 26 7.489324e+02
## 27 2.456861e-01
## 28 2.405441e-02
## 29 2.311315e-01
## 30 5.233792e-03
## 31 1.605928e-01
## 32 7.547651e-04</code></pre>
</div>
<div id="finite-sample-bias" class="section level3">
<h3><span class="header-section-number">4.1.3</span> Finite sample bias</h3>
<p><span class="citation">Hahn and Hausman (<a href="#ref-Hahn02a">2002</a>)</span></p>
</div>
</div>
<div id="bootstrap-inference" class="section level2">
<h2><span class="header-section-number">4.2</span> Bootstrap inference</h2>
<p><span class="citation">Young (<a href="#ref-Young2017">2018</a>)</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Set Number of Digits</span>
<span class="kw">options</span>(<span class="dt">digits =</span> <span class="dv">4</span>)

############################################
<span class="co"># Now use real data (augmented AJR dataset)</span>
############################################
<span class="kw">library</span>(foreign)
clean &lt;-<span class="kw">read.dta</span>(<span class="st">&quot;ajr.dta&quot;</span>)
<span class="kw">summary</span>(clean)</code></pre></div>
<pre><code>##     logpgp95         avexpr          logem4       gold_silv    
##  Min.   : 6.11   Min.   : 3.50   Min.   :2.15   Min.   :0.000  
##  1st Qu.: 7.33   1st Qu.: 5.64   1st Qu.:4.23   1st Qu.:0.000  
##  Median : 7.95   Median : 6.50   Median :4.36   Median :0.000  
##  Mean   : 8.08   Mean   : 6.56   Mean   :4.67   Mean   :0.328  
##  3rd Qu.: 8.84   3rd Qu.: 7.46   3rd Qu.:5.48   3rd Qu.:1.000  
##  Max.   :10.22   Max.   :10.00   Max.   :7.99   Max.   :1.000  
##    resources        lpd1500s         lpd1995         landlock     
##  Min.   :0.000   Min.   :-3.831   Min.   :0.854   Min.   :0.0000  
##  1st Qu.:0.000   1st Qu.:-0.038   1st Qu.:2.950   1st Qu.:0.0000  
##  Median :1.000   Median : 0.432   Median :3.718   Median :0.0000  
##  Mean   :0.639   Mean   : 0.449   Mean   :3.843   Mean   :0.0984  
##  3rd Qu.:1.000   3rd Qu.: 1.442   3rd Qu.:4.661   3rd Qu.:0.0000  
##  Max.   :1.000   Max.   : 4.610   Max.   :8.684   Max.   :1.0000  
##     lat_abst         f_spain          f_germ           f_brit     
##  Min.   :0.0000   Min.   :0.000   Min.   :0.0000   Min.   :0.000  
##  1st Qu.:0.0889   1st Qu.:0.000   1st Qu.:0.0000   1st Qu.:0.000  
##  Median :0.1500   Median :0.000   Median :0.0000   Median :0.000  
##  Mean   :0.1793   Mean   :0.262   Mean   :0.0328   Mean   :0.361  
##  3rd Qu.:0.2556   3rd Qu.:1.000   3rd Qu.:0.0000   3rd Qu.:1.000  
##  Max.   :0.6667   Max.   :1.000   Max.   :1.0000   Max.   :1.000  
##     f_pothco          africa          asia         shortnam        
##  Min.   :0.0000   Min.   :0.00   Min.   :0.000   Length:61         
##  1st Qu.:0.0000   1st Qu.:0.00   1st Qu.:0.000   Class :character  
##  Median :0.0000   Median :0.00   Median :0.000   Mode  :character  
##  Mean   :0.0328   Mean   :0.41   Mean   :0.147                     
##  3rd Qu.:0.0000   3rd Qu.:1.00   3rd Qu.:0.000                     
##  Max.   :1.0000   Max.   :1.00   Max.   :1.000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">#####################################
<span class="co"># Let&#39;s focus on the first stage</span>
<span class="co"># and illustrate the boot command</span>
#####################################
<span class="kw">library</span>(car)
<span class="kw">library</span>(boot)
<span class="kw">set.seed</span>(<span class="dv">666</span>)
<span class="co"># Original AJR type specification</span>
first &lt;-<span class="st"> </span><span class="kw">lm</span>(avexpr<span class="op">~</span>logem4<span class="op">+</span>lat_abst<span class="op">+</span>africa<span class="op">+</span>asia, <span class="dt">data=</span>clean)
<span class="kw">summary</span>(first)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = avexpr ~ logem4 + lat_abst + africa + asia, data = clean)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.8003 -0.9043  0.0861  0.8949  3.1346 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    8.348      0.923    9.05  1.5e-12 ***
## logem4        -0.472      0.176   -2.68   0.0096 ** 
## lat_abst       2.259      1.380    1.64   0.1073    
## africa        -0.101      0.416   -0.24   0.8088    
## asia           0.319      0.494    0.65   0.5212    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.25 on 56 degrees of freedom
## Multiple R-squared:  0.32,   Adjusted R-squared:  0.271 
## F-statistic: 6.58 on 4 and 56 DF,  p-value: 0.000207</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">linearHypothesis</span>(first,<span class="kw">c</span>(<span class="st">&quot;logem4 = 0&quot;</span>),<span class="dt">test=</span><span class="st">&quot;F&quot;</span>)</code></pre></div>
<pre><code>## Linear hypothesis test
## 
## Hypothesis:
## logem4 = 0
## 
## Model 1: restricted model
## Model 2: avexpr ~ logem4 + lat_abst + africa + asia
## 
##   Res.Df  RSS Df Sum of Sq    F Pr(&gt;F)   
## 1     57 98.6                            
## 2     56 87.4  1      11.2 7.19 0.0096 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(first.boot &lt;-<span class="st"> </span><span class="kw">Boot</span>(first, <span class="dt">R=</span><span class="dv">1000</span>))</code></pre></div>
<pre><code>##    user  system elapsed 
##    1.66    0.00    1.72</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(first.boot, <span class="dt">high.moments=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## 
## Number of bootstrap replications R = 1000 
##             original bootBias bootSE bootMed bootSkew bootKurtosis
## (Intercept)    8.348  0.00372  1.047   8.335   0.0416        0.234
## logem4        -0.472 -0.00074  0.203  -0.474  -0.1023        0.210
## lat_abst       2.259 -0.11526  1.466   2.303  -0.3693        0.402
## africa        -0.101  0.01307  0.372  -0.123   0.5226        0.840
## asia           0.319 -0.00307  0.527   0.302   0.1365        0.131</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#hist(first.boot, legend=&quot;separate&quot;)</span>

bs &lt;-<span class="st"> </span><span class="cf">function</span>(formula, data, indices) {
  d &lt;-<span class="st"> </span>data[indices,] 
  first &lt;-<span class="st"> </span><span class="kw">lm</span>(formula, <span class="dt">data=</span>d)
  partialF &lt;-<span class="st"> </span><span class="kw">linearHypothesis</span>(first,<span class="kw">c</span>(<span class="st">&quot;logem4 = 0&quot;</span>),<span class="dt">test=</span><span class="st">&quot;F&quot;</span>)[<span class="dv">2</span>,<span class="dv">5</span>]
  <span class="kw">return</span>(partialF) 
} 

bootF &lt;-<span class="st"> </span><span class="kw">boot</span>(<span class="dt">data=</span>clean, <span class="dt">statistic=</span>bs,<span class="dt">R=</span><span class="dv">500</span>,<span class="dt">formula=</span>avexpr<span class="op">~</span>logem4<span class="op">+</span>lat_abst<span class="op">+</span>africa<span class="op">+</span>asia)
<span class="kw">summary</span>(bootF,<span class="dt">high.moments=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##     R original bootBias bootSE bootMed bootSkew bootKurtosis
## 1 500     7.19     1.41   6.72     7.3     1.09         1.27</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(bootF)</code></pre></div>
<p><img src="04-IV_RDD_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boot.ci</span>(bootF, <span class="dt">type=</span><span class="st">&quot;bca&quot;</span>)</code></pre></div>
<pre><code>## BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
## Based on 500 bootstrap replicates
## 
## CALL : 
## boot.ci(boot.out = bootF, type = &quot;bca&quot;)
## 
## Intervals : 
## Level       BCa          
## 95%   ( 0.031, 23.420 )  
## Calculations and Intervals on Original Scale
## Some BCa intervals may be unstable</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">#################################################
<span class="co"># Something you should ALWAYS do, at a minimum</span>
<span class="co"># Bootstrap the second stage since residual </span>
<span class="co"># for Durbin-Wu-Hausman test is generated</span>
#################################################
first &lt;-<span class="st"> </span><span class="kw">lm</span>(avexpr <span class="op">~</span><span class="st"> </span>logem4 <span class="op">+</span><span class="st"> </span>lat_abst, <span class="dt">data=</span>clean)
res &lt;-<span class="st"> </span><span class="kw">summary</span>(first)<span class="op">$</span>residual
structural &lt;-<span class="st"> </span><span class="kw">lm</span>(logpgp95 <span class="op">~</span><span class="st"> </span>avexpr <span class="op">+</span><span class="st"> </span>lat_abst <span class="op">+</span><span class="st"> </span>res, <span class="dt">data=</span>clean)
<span class="kw">summary</span>(structural)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = logpgp95 ~ avexpr + lat_abst + res, data = clean)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -2.048 -0.227  0.032  0.403  1.163 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    2.079      0.770    2.70  0.00911 ** 
## avexpr         0.932      0.131    7.13  1.9e-09 ***
## lat_abst      -0.620      0.806   -0.77  0.44534    
## res           -0.569      0.146   -3.90  0.00025 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.607 on 57 degrees of freedom
## Multiple R-squared:  0.666,  Adjusted R-squared:  0.648 
## F-statistic: 37.8 on 3 and 57 DF,  p-value: 1.37e-13</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(structural.boot &lt;-<span class="st"> </span><span class="kw">Boot</span>(structural, <span class="dt">R=</span><span class="dv">1000</span>))</code></pre></div>
<pre><code>##    user  system elapsed 
##    1.89    0.03    2.18</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(structural.boot)</code></pre></div>
<pre><code>## 
## Number of bootstrap replications R = 1000 
##             original bootBias bootSE bootMed
## (Intercept)    2.079  0.00733  0.744   2.041
## avexpr         0.932 -0.00171  0.134   0.941
## lat_abst      -0.620  0.04108  0.840  -0.628
## res           -0.569  0.00675  0.168  -0.579</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(structural.boot, <span class="dt">legend=</span><span class="st">&quot;separate&quot;</span>)</code></pre></div>
<p><img src="04-IV_RDD_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">confint</span>(structural, <span class="dt">level=</span>.<span class="dv">95</span>, <span class="dt">type=</span><span class="st">&quot;bca&quot;</span>)</code></pre></div>
<pre><code>##               2.5 %  97.5 %
## (Intercept)  0.5373  3.6211
## avexpr       0.6707  1.1942
## lat_abst    -2.2344  0.9950
## res         -0.8613 -0.2773</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">############################################
<span class="co"># Now bootstrap the IV results themselves</span>
############################################
<span class="kw">library</span>(AER)
iv &lt;-<span class="st"> </span><span class="kw">ivreg</span>(logpgp95 <span class="op">~</span><span class="st"> </span>avexpr <span class="op">+</span><span class="st"> </span>lat_abst <span class="op">|</span><span class="st"> </span>lat_abst <span class="op">+</span><span class="st"> </span>logem4, <span class="dt">data=</span>clean)
<span class="kw">summary</span>(iv)</code></pre></div>
<pre><code>## 
## Call:
## ivreg(formula = logpgp95 ~ avexpr + lat_abst | lat_abst + logem4, 
##     data = clean)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.4294 -0.6132  0.0638  0.6804  1.7229 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    2.079      1.173    1.77    0.082 .  
## avexpr         0.932      0.199    4.68  1.8e-05 ***
## lat_abst      -0.620      1.229   -0.50    0.616    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.925 on 58 degrees of freedom
## Multiple R-Squared: 0.21,    Adjusted R-squared: 0.183 
## Wald test: 17.6 on 2 and 58 DF,  p-value: 1.03e-06</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ivboot &lt;-<span class="st"> </span><span class="kw">Boot</span>(iv,<span class="dt">R=</span><span class="dv">2000</span>)
<span class="kw">summary</span>(ivboot)</code></pre></div>
<pre><code>## 
## Number of bootstrap replications R = 2000 
##             original bootBias bootSE bootMed
## (Intercept)    2.079   -0.831   6.15   2.072
## avexpr         0.932    0.139   1.07   0.932
## lat_abst      -0.620   -0.452   4.81  -0.579</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#hist(ivboot, xlim=c(-8, 4), legend=&quot;separate&quot;)</span>
<span class="kw">hist</span>(ivboot, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">legend=</span><span class="st">&quot;separate&quot;</span>)</code></pre></div>
<p><img src="04-IV_RDD_files/figure-html/unnamed-chunk-4-3.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">confint</span>(ivboot, <span class="dt">level=</span>.<span class="dv">95</span>, <span class="dt">type=</span><span class="st">&quot;bca&quot;</span>)</code></pre></div>
<pre><code>## Bootstrap bca confidence intervals
## 
##              2.5 % 97.5 %
## (Intercept) -8.583  3.789
## avexpr       0.655  2.690
## lat_abst    -7.923  1.426</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">#####################################
<span class="co"># Now let&#39;s bootstrap the 2sls </span>
<span class="co"># results by hand by resampling</span>
#####################################

first &lt;-<span class="st"> </span><span class="kw">lm</span>(avexpr <span class="op">~</span><span class="st"> </span>logem4 <span class="op">+</span><span class="st"> </span>lat_abst, <span class="dt">data=</span>clean)
res &lt;-<span class="st"> </span><span class="kw">summary</span>(first)<span class="op">$</span>residual
structural &lt;-<span class="st"> </span><span class="kw">lm</span>(logpgp95 <span class="op">~</span><span class="st"> </span>avexpr <span class="op">+</span><span class="st"> </span>lat_abst <span class="op">+</span><span class="st"> </span>res, <span class="dt">data=</span>clean)
<span class="kw">summary</span>(structural)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = logpgp95 ~ avexpr + lat_abst + res, data = clean)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -2.048 -0.227  0.032  0.403  1.163 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    2.079      0.770    2.70  0.00911 ** 
## avexpr         0.932      0.131    7.13  1.9e-09 ***
## lat_abst      -0.620      0.806   -0.77  0.44534    
## res           -0.569      0.146   -3.90  0.00025 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.607 on 57 degrees of freedom
## Multiple R-squared:  0.666,  Adjusted R-squared:  0.648 
## F-statistic: 37.8 on 3 and 57 DF,  p-value: 1.37e-13</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">N &lt;-<span class="st"> </span><span class="kw">nrow</span>(clean)
bootstrap &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">out =</span> <span class="st">&quot;coef&quot;</span>) {
  b.samp &lt;-<span class="st"> </span><span class="kw">sample</span>(N, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
  b.first &lt;-<span class="st"> </span><span class="kw">lm</span>(avexpr <span class="op">~</span><span class="st"> </span>logem4 <span class="op">+</span><span class="st"> </span>lat_abst, <span class="dt">data=</span>clean[b.samp, ])
  b.res &lt;-<span class="st"> </span><span class="kw">summary</span>(b.first)<span class="op">$</span>residual
  b.structural &lt;-<span class="st"> </span><span class="kw">lm</span>(logpgp95 <span class="op">~</span><span class="st"> </span>avexpr <span class="op">+</span><span class="st"> </span>lat_abst <span class="op">+</span><span class="st"> </span>b.res, <span class="dt">data=</span>clean[b.samp, ])
  <span class="cf">if</span> (out <span class="op">==</span><span class="st"> &quot;coef&quot;</span>) {
    out &lt;-<span class="st"> </span><span class="kw">summary</span>(b.structural)<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>]
  } <span class="cf">else</span> {
    <span class="kw">stop</span>(<span class="st">&quot;Unknown output statistic.&quot;</span>)
  }
  out
}
b.samps.coef &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">bootstrap</span>(<span class="dt">out =</span> <span class="st">&quot;coef&quot;</span>))
<span class="kw">hist</span>(b.samps.coef, <span class="dt">breaks=</span><span class="dv">200</span>)</code></pre></div>
<p><img src="04-IV_RDD_files/figure-html/unnamed-chunk-4-4.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#hist(b.samps.coef, xlim=c(-1,3), breaks=200)</span>
<span class="kw">c</span>(<span class="kw">summary</span>(structural)<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>], <span class="kw">sd</span>(b.samps.coef))</code></pre></div>
<pre><code>## [1] 0.1307 0.7954</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Bootstrap the Durbin-Wu-Hausman statistic manually through resampling</span>
N &lt;-<span class="st"> </span><span class="kw">nrow</span>(clean)
bootstrap &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">out =</span> <span class="st">&quot;coef&quot;</span>) {
  b.samp &lt;-<span class="st"> </span><span class="kw">sample</span>(N, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
  b.first &lt;-<span class="st"> </span><span class="kw">lm</span>(avexpr <span class="op">~</span><span class="st"> </span>logem4 <span class="op">+</span><span class="st"> </span>lat_abst, <span class="dt">data=</span>clean[b.samp, ])
  b.res &lt;-<span class="st"> </span><span class="kw">summary</span>(b.first)<span class="op">$</span>residual
  b.structural &lt;-<span class="st"> </span><span class="kw">lm</span>(logpgp95 <span class="op">~</span><span class="st"> </span>avexpr <span class="op">+</span><span class="st"> </span>lat_abst <span class="op">+</span><span class="st"> </span>b.res, <span class="dt">data=</span>clean[b.samp, ])
  <span class="cf">if</span> (out <span class="op">==</span><span class="st"> &quot;coef&quot;</span>) {
    out &lt;-<span class="st"> </span><span class="kw">summary</span>(b.structural)<span class="op">$</span>coefficients[<span class="dv">4</span>, <span class="dv">2</span>]
  } <span class="cf">else</span> {
    <span class="kw">stop</span>(<span class="st">&quot;Unknown output statistic.&quot;</span>)
  }
  out
}
b.samps.coef &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">2000</span>, <span class="kw">bootstrap</span>(<span class="dt">out =</span> <span class="st">&quot;coef&quot;</span>))
<span class="kw">hist</span>(b.samps.coef, <span class="dt">breaks=</span><span class="dv">200</span>)</code></pre></div>
<p><img src="04-IV_RDD_files/figure-html/unnamed-chunk-4-5.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#hist(b.samps.coef, xlim=c(-1,3), breaks=200)</span>
<span class="kw">c</span>(<span class="kw">summary</span>(structural)<span class="op">$</span>coefficients[<span class="dv">4</span>, <span class="dv">2</span>], <span class="kw">sd</span>(b.samps.coef))</code></pre></div>
<pre><code>## [1] 0.1458 0.1663</code></pre>
<p>The basic lesson is that you shouldn’t forget to the do the Hausman test of the null of exogeneity</p>
</div>
<div id="failure-of-the-exclusion-restriction" class="section level2">
<h2><span class="header-section-number">4.3</span> Failure of the exclusion restriction</h2>
<p><span class="citation">Conley, Hansen, and Rossi (<a href="#ref-Conley2012">2012</a>)</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">##################################################################
<span class="co"># One last small useful IV tool</span>
<span class="co"># Conley, Hansen and Rossi (2012)</span>
<span class="co"># Sensitivity of IV results to violation of exclusion restriction</span>
##################################################################
<span class="co"># Intuition</span>
phi &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)
violation &lt;-<span class="st"> </span><span class="cf">function</span>(g) {
  YY &lt;-<span class="st"> </span>clean<span class="op">$</span>logpgp95 <span class="op">-</span><span class="st"> </span>g <span class="op">*</span><span class="st"> </span>clean<span class="op">$</span>logem4
  <span class="kw">rbind</span>(g, <span class="kw">summary</span>(<span class="kw">ivreg</span>(YY <span class="op">~</span><span class="st"> </span>avexpr <span class="op">+</span><span class="st"> </span>lat_abst, <span class="op">~</span>logem4 <span class="op">+</span><span class="st"> </span>lat_abst, 
             <span class="kw">cbind</span>(clean, YY)))<span class="op">$</span>coef[<span class="dv">2</span>,<span class="dv">1</span>],
        <span class="kw">summary</span>(<span class="kw">ivreg</span>(YY <span class="op">~</span><span class="st"> </span>avexpr <span class="op">+</span><span class="st"> </span>lat_abst, <span class="op">~</span>logem4 <span class="op">+</span><span class="st"> </span>lat_abst, 
                      <span class="kw">cbind</span>(clean, YY)))<span class="op">$</span>coef[<span class="dv">2</span>,<span class="dv">2</span>])
}
altcoefs &lt;-<span class="st"> </span><span class="kw">sapply</span>(phi, violation)
<span class="kw">rownames</span>(altcoefs) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;phi&quot;</span>,<span class="st">&quot;coef&quot;</span>,<span class="st">&quot;se&quot;</span>)
<span class="kw">round</span>(altcoefs, <span class="dv">3</span>)</code></pre></div>
<pre><code>##        [,1]   [,2]   [,3]   [,4]   [,5]   [,6]   [,7]   [,8]   [,9]  [,10]
## phi  -1.000 -0.900 -0.800 -0.700 -0.600 -0.500 -0.400 -0.300 -0.200 -0.100
## coef -0.951 -0.763 -0.574 -0.386 -0.198 -0.009  0.179  0.367  0.556  0.744
## se    0.372  0.326  0.281  0.237  0.197  0.163  0.139  0.130  0.139  0.164
##      [,11] [,12] [,13] [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21]
## phi  0.000 0.100 0.200 0.300 0.400 0.500 0.600 0.700 0.800 0.900 1.000
## coef 0.932 1.121 1.309 1.498 1.686 1.874 2.063 2.251 2.439 2.628 2.816
## se   0.199 0.239 0.283 0.328 0.375 0.422 0.470 0.518 0.567 0.615 0.664</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># + new package I have been playing with when you only have one jointly</span>
<span class="co"># endogenous RHS variable: ivmodel</span>
<span class="kw">library</span>(ivmodel)
model &lt;-<span class="st">  </span><span class="kw">ivmodelFormula</span>(logpgp95 <span class="op">~</span><span class="st"> </span>avexpr <span class="op">+</span><span class="st"> </span>lat_abst <span class="op">|</span><span class="st"> </span>lat_abst <span class="op">+</span><span class="st"> </span>logem4, <span class="dt">data=</span>clean)
<span class="kw">summary</span>(model)</code></pre></div>
<pre><code>## 
## Call:
## ivmodel(Y = Y, D = D, Z = Z, intercept = intercept, beta0 = beta0, 
##     alpha = alpha, k = k, heteroSE = heteroSE, clusterID = clusterID, 
##     deltarange = deltarange, na.action = na.action)
## sample size: 61
## _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
## 
## First Stage Regression Result:
## 
## F=23.46, df1=1, df2=59, p-value is 9.6e-06
## R-squared=0.2845,   Adjusted R-squared=0.2724
## Residual standard error: 1.248 on 60 degrees of freedom
## _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
## 
## Coefficients of k-Class Estimators:
## 
##             k Estimate Std. Error t value Pr(&gt;|t|)    
## OLS    0.0000   0.5197     0.0609    8.53  7.1e-12 ***
## Fuller 0.9831   0.8662     0.1392    6.22  5.5e-08 ***
## LIML   1.0000   0.8872     0.1453    6.11  8.6e-08 ***
## TSLS   1.0000   0.8872     0.1453    6.11  8.6e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
## 
## Alternative tests for the treatment effect under H_0: beta=0.
## 
## Anderson-Rubin test:
## F=49.81, df1=1, df2=59, p-value=2.2e-09
## 95 percent confidence interval:
##  [ 0.656704700430494 , 1.32915681156195 ]
## 
## Conditional Likelihood Ratio test:
## Test Stat=49.81, p-value=2.2e-09
## 95 percent confidence interval:
##  [0.656704748900843, 1.32915663344458]</code></pre>
</div>
<div id="the-gmm-black-box" class="section level2">
<h2><span class="header-section-number">4.4</span> The GMM black box</h2>
<p><span class="citation">Bazzi and Clemens (<a href="#ref-Bazzi2013">2013</a>)</span> <span class="citation">Harding, Hausman, and Palmer (<a href="#ref-Harding2015">2016</a>)</span></p>
</div>
<div id="regression-discontinuity-design" class="section level2">
<h2><span class="header-section-number">4.5</span> Regression discontinuity design</h2>
<p><span class="citation">Imbens and Lemieux (<a href="#ref-Imbens2008">2008</a>)</span> <span class="citation">Lee and Lemieux (<a href="#ref-Lee10">2010</a>)</span></p>
<div id="application-to-a-development-program" class="section level3">
<h3><span class="header-section-number">4.5.1</span> Application to a development program</h3>
</div>
<div id="pushing-the-outcome-variable" class="section level3">
<h3><span class="header-section-number">4.5.2</span> Pushing the outcome variable</h3>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Hausman83">
<p>Hausman, Jerry A. 1983. “Specification and Estimation of Simultaneous Equation Models.” In <em>Handbook of Econometrics</em>, edited by Zvi Griliches and M. Intriligator, 1:391–448. The Netherlands: North Holland.</p>
</div>
<div id="ref-Hahn02a">
<p>Hahn, Jinyong, and Jerry A. Hausman. 2002. “Notes on Bias in Estimators for Simultaneous Equation Models.” <em>Economics Letters</em> 75 (2): 237–41.</p>
</div>
<div id="ref-Young2017">
<p>Young, Alwyn. 2018. “Consistency Without Inference: Instrumental Variables in Practical Applications.”</p>
</div>
<div id="ref-Conley2012">
<p>Conley, Timothy G, Christian Hansen, and Peter E. Rossi. 2012. “Plausibly Exogenous.” <em>Review of Economics and Statistics</em> 94 (1): 260–72.</p>
</div>
<div id="ref-Bazzi2013">
<p>Bazzi, Samuel, and Michael A. Clemens. 2013. “Blunt Instruments: Avoiding Common Pitfalls in Identifying the Causes of Economic Growth.” <em>American Economic Journal: Macroeconomics</em> 5 (2): 152–86.</p>
</div>
<div id="ref-Harding2015">
<p>Harding, Matthew, Jerry A. Hausman, and Christopher J. Palmer. 2016. “Finite Sample Bias Corrected IV Estimation for Weak and Many Instruments.” In <em>Advances in Econometrics: Essays in Honor of Aman Ullah</em>, 36:245–73. Emerald Publishing.</p>
</div>
<div id="ref-Imbens2008">
<p>Imbens, Guido W., and Thomas Lemieux. 2008. “Regression Discontinuity Designs: A Guide to Practice.” <em>Journal of Econometrics</em> 142 (2): 615–35.</p>
</div>
<div id="ref-Lee10">
<p>Lee, David S., and Thomas Lemieux. 2010. “Regression Discontinuity Designs in Economics.” <em>Journal of Economic Literature</em> 48 (2): 281–355.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="setting-up-an-evaluation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="panel-data-structures.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
